<!DOCTYPE html>

    <head>

        <meta charset='UTF-8'>
        <meta http-equiv='X-UA-Compatible" content="IE=edge'>
        <meta name='viewport" content='width=device-width, initial-scale=1.0'>                    
        <title> Distance calculator! </title>  
        <script src='point.js'> </script> 
        <script src='poi.js'> </script> 
        <script src='calculateDistance.js'> </script>
        <link rel="stylesheet" href="stylesheet.css">                
                              

    </head>

    <body>

        <h1>  Distance Calculator! </h1>

        <p id="first">  Here you can calculate the distances between points!  </p>

        <br /><br /><br /><br /><br /><br /><br />
    
        <!-- Hier erstelle ich ein Textfeld, wo man sowohl das GeoJSON einfügen, aber auch der aktuelle Standort als GeoJSON angezeigt wird-->
        <div>  
            <textarea id="textfield" type = "text" name="text" cols="35" rows="4" placeholder="GeoJSON hier einfügen..." ></textarea> 	
        </div> 

        <!-- Hier erstelle ich einen Button, mit welchem ich die Funktion "getLocation ausführe"-->
        <div>
            <p>Press the Button to get your coordinates!</p>
            <button onclick="getLocation()"></button>
            <p id="demo"></p>
        </div>

        <div>
            <p>Press the Button to calculate the distance with your point!</p>
            <button onclick="calculatePoint()"> </button>
        </div>

        <p id="ausgabe">  </p>

        <script>

            /*
                    
                        var low = {
            "type": "FeatureCollection",
            "features": [
            {
            "type": "Feature",
            "properties": {
            "shape": "Marker",
            "name": "Hauptbahnhof",
            "category": "default"
            },
            "geometry": {
            "type": "Point",
            "coordinates": [
            7.634876,
            51.957004
            ]
            },
            "id": "1f1c1e76-de1e-4bf5-b927-0a0bdb59a10e"
            },]}
                console.log(low.features.name)
            */
    
            /**
             * this function activates, when the second button is pushed. it takes the input from the textfield and checks, whether it is an valid GeoJSON and afterwards if it is a point. 
             * Lastly it takes the point and uses it for the calculation.
             */ 
            function calculatePoint(){

                let JSON_input = document.getElementById("textfield")

                // testing 
                console.log(JSON_input);

                // Here I check, whether the input is viable as a JSON/GeoJSON object
                if(isJsonString(JSON_input.value)){

                    // Here I check, whether the GeoJSON is a point, because only than i can calculate properly
                    if(JSON.parse(JSON_input.value).type == "Point"){

                        point = JSON.parse(JSON_input.value);
                        console.log(point)
                        calculateDistance(point);
                    }
                    else{

                        // Error!
                        alert("WRONG INPUT! PLEASE TRY AGAIN");

                    }      

                }
                else{

                    // Error!
                    alert("WRONG INPUT! PLEASE TRY AGAIN");

                }


            }


            /**
             * 
             * This function checks, whether a JSON input is valid
             * source: https://stackoverflow.com/questions/3710204/how-to-check-if-a-string-is-a-valid-json-string
             * @return  returns a boolean result, depending if the JSON input is valid or not
            */   
            function isJsonString(str) {

                try{

                JSON.parse(str);

                } 

                catch (e){

                return false;

                }

                return true;
            }
        
            

            /**
             *  This function is used, when the first button is pushed. It determines your location. This function is given in the task's description.
             *  source: https://www.w3schools.com/html/html5_geolocation.asp
            */
            function getLocation() {

                var x = document.getElementById("demo");

                if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
                }   
                else{ 
                x.innerHTML = "Geolocation is not supported by this browser.";
                }

            }

            /**
             * This function fills in the GeoJSON into the textfield
             */
            function showPosition(position) {

                let location = new Array(position.coords.longitude, position.coords.latitude);

                location = new JSONConstructor(location, "Point");

                document.getElementById("textfield").innerHTML = JSON.stringify(location);

                let reader = new FileReader();

                reader = JSON.stringify(document.getElementById("textfield").value);

                console.log(reader);

            }
            
            /**
             * This functions as a normal constructor, to construct an 
             */
            function JSONConstructor(array, type){

                this.type = type;
                this.coordinates = array;

            }

            document.getElementById("ausgabe").innerHTML = ausgabe;

        </script>
        
    </body>

</html>